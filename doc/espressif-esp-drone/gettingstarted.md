<!-- Переведено с https://docs.espressif.com/projects/espressif-esp-drone/en/latest/ -->
<!-- Оригинал: английский | Перевод: русский | Инструмент: Google Translate API -->

# Начать

[中文]

## Обзор ESP-дрона

ESP-Drone — это летающая плата для разработки на базе ESP32/ESP32-S2/ESP32-S3, предоставляемая Espressif. ESP-Drone оснащен ключевыми функциями Wi-Fi, которые позволяют подключать этот дрон и управлять им с помощью приложения или геймпада через сеть Wi-Fi. Этот дрон поставляется с простым аппаратным обеспечением, понятными кодами и поддерживает функциональное расширение. Таким образом, ESP-Drone можно использовать в STEAM-обучении. Часть кодов взята из проекта Crazyflie с открытым исходным кодом под лицензией GPL3.0.
лицензия.

![ESP-Drone](_images/espdrone_s2_v1_2_2.png)

ESP-Дрон

### Основные характеристики

ESP-Drone имеет следующие возможности:

- Режим стабилизации: сохраняйте устойчивость дрона для достижения плавного полета.
- Режим удержания высоты: контролируйте мощность тяги, чтобы дрон летел на фиксированной высоте.
- Режим удержания позиции: удерживайте дрон в фиксированном положении.
- Отладка ПК: используйте cfclient для статической/динамической отладки.
- Управляется через приложение: легко управляется через Wi-Fi с помощью мобильного приложения.
- Управление с помощью геймпада: легко управлять с помощью cfclient через геймпад.

### Основные компоненты

ESP-Drone 2.0 состоит из основной платы и нескольких плат расширения:

- Основная плата: включает модуль ESP32-S2, необходимые датчики для базового полета и предоставляет интерфейсы расширения аппаратного обеспечения.
- Платы расширения: интегрируйте датчики расширения через аппаратные интерфейсы расширения основной платы для реализации расширенного полета.

| No. | Модули | Основные компоненты | Функция | Интерфейсы | Место крепления |
| --- | --- | --- | --- | --- | --- |
| 1 | Основная плата — ESP32-S2 | ESP32-S2-WROVER + MPU6050 | Базовый рейс | I2C, SPI, GPIO, интерфейсы расширения |  |
| 2 | Плата расширения — модуль удержания позиции | ПМВ3901 + ВЛ53Л1Х | Положение в помещении с удержанием полета | SPI + I2C | Крепление внизу, лицом к земле. |
| 3 | Плата расширения — модуль давления | Модуль давления MS5611 | Удержание высоты полета | I2C или подчиненный MPU6050 | Крепление сверху или снизу |
| 4 | Плата расширения — модуль компаса | HMC5883 компас | Расширенный режим полета, например режим без головы | I2C или подчиненный MPU6050 | Крепление сверху или снизу |

Дополнительную информацию см. в разделе «Справочник по оборудованию».

## Обзор ESP-IDF

ESP-IDF — это платформа разработки Интернета вещей, предоставляемая Espressif для ESP32/ESP32-S2/ESP32-S3.

- ESP-IDF — это набор библиотек и заголовочных файлов, содержащий основные программные компоненты, необходимые для создания любых программных проектов на ESP32/ESP32-S2.
- ESP-IDF также предоставляет инструменты и утилиты, необходимые для типичных сценариев использования для разработчиков и производства, таких как сборка, прошивка, отладка и измерение.

Для получения дополнительной информации проверьте ESP-IDF.
Руководство по программированию.

## Обзор Crazyflie

Crazyflie — это квадрокоптер Bitcraze с открытым исходным кодом, обладающий следующими функциями:

- Поддержка различных комбинаций датчиков для расширенных режимов полета, таких как режим удержания высоты и режим удержания положения.
- Основан на FreeRTOS, которая позволяет пользователям разбивать сложные системы дронов на несколько программных задач с различными приоритетами.
- Настраиваемый полнофункциональный протокол связи cfclient и CRTP для целей отладки, измерения и управления.

![crazyflie-overview](_images/crazyflie-overview.png)

Рой дронов исследует окружающую среду, избегая препятствий
и друг друга. (Гуус Шунвилл, Технический университет Делфта)

Для получения дополнительной информации см. Crazyflie.

## Препараты

### Сборка оборудования

Пожалуйста, следуйте инструкциям ниже, чтобы собрать ESP32-S2-Drone V1.2.

![ESP32-S2-Drone V1.2 Assemble Flow](_images/assembling_en.png)

ESP32-S2-Drone V1.2 Схема сборки

Обзор оборудования и расположение контактов доступны по адресу: Справочник по оборудованию.

### Загрузите и установите приложение ESP-Drone

Приложение ESP-Drone доступно для Android и iOS.

Для Android отсканируйте QR-код ниже, чтобы загрузить приложение ESP-Drone.

![Android APP QR](_images/android_app_download.png)

Для iOS найдите и загрузите приложение ESP-Drone в App Store.

Исходный код приложения iOS: ESP-Drone-iOS

Исходный код Android-приложения: ESP-Drone-Android

### Установить cfclient

Этот шаг не является обязательным и предназначен только для расширенной отладки.

![cfclient Interface](_images/cfclient.png)

cfclient Интерфейс

1. Установите cfclient

1.1 Загрузите исходный код

```
git clone https://github.com/qljz1993/crazyflie-clients-python.git

```

1.2 Зайдите в каталог

```
cd crazyflie-clients-python

```

1.3 Установите cfclient

```
pip3 install -e .

```

1.4 Запуск клиента

```
cfclient

```

2. Настройте контроллеры

![Controller Configuration](_images/gamepad_settings.png)

Конфигурация контроллера

2.1 Настройте четыре основных параметра управления: крен, тангаж, рыскание, тяга.

2.2 Кнопка настройки. Вспомогательное управление переключением режимов полета.

## Руководство по приложению ESP-Drone

### Установить соединение Wi-Fi

- Сканируйте точку доступа Wi-Fi на своем мобильном телефоне. Устройство ESP-Drone работает как точка доступа Wi-Fi со следующим SSID:

```
SSID: ESP-DRONE_XXXX (XXXX is configured based on MAC) PASSWORD: 12345678

```

- Нажмите на эту точку доступа, подключите свой мобильный телефон к этой точке доступа.

Теперь между вашим мобильным телефоном и дроном установлено Wi-Fi-соединение.

### Настроить параметры

На этом этапе вы можете настроить параметры полета в соответствии со сценариями вашего приложения или использовать конфигурацию по умолчанию, приведенную ниже.

```
```
Default configuration:

Flight control settings
    1. Mode: Mode2
    2. Deadzone: 0.2
    3. Roll trim: 0.0
    4. Pitch trim: 0.0
    5. Advanced flight control: true
    6. Advanced flight control preferences
        1. max roll/pitch angle: 15
        2. max yaw angle: 90
        3. max thrust: 90
        4. min thrust: 25
        5. X-Mode: true
Controller settings
    7. use full travel for thrust: false
    8. virtual joystick size: 100
App settings
    9. Screen rotation lock: true
    10. full screen mode:true
    11. show console: true
```

```

### Управление полетом

- Нажмите кнопку/значок «Подключиться» в вашем приложении. Когда соединение между вашим дроном и приложением успешно установлено, светодиод на дроне мигает ЗЕЛЕНЫМ.
- Слегка сдвиньте «Тягу», чтобы снять дрон.
- Управляйте полетом, перемещая пальцы по приложению.

![Android APP Interface](_images/espdrone_app_android_en.png)

Интерфейс приложения Android

## Руководство по работе с клиентом для ПК

Cfclient — это клиент для ПК для исходного проекта Crazeflie, который полностью реализовал функции, определенные в CRTP, и ускоряет отладку дронов. ESP-Drone настраивает этот клиент в соответствии с потребностями функционального дизайна.

![cfclient architecture](_images/cfclient_architecture.png)

Cfclient Архитектура

![cfclient console interface](_images/cfclient.png)

Консольный интерфейс Cfclient

В этом проекте у нас есть файлы конфигурации и файлы кэша. Файл JSON используется для хранения информации о конфигурации. Дополнительную информацию о конфигурации см. в разделе Пользователь.
Файл конфигурации.

### Настройки полета

#### Базовое управление полетом

- Режим полета: нормальный и расширенный режимы. Обычный режим: для новичков. Расширенный режим: разблокируйте максимальный угол и максимальную тягу.
- Вспомогательный режим Режим удержания высоты: поддержание высоты полета. Для реализации этого режима необходим датчик барометрического давления. Режим удержания позиции: сохранение текущей позиции полета. Для реализации этого режима необходимы оптический датчик потока и датчик времени пролета (TOF). Режим удержания высоты: сохранение высоты полета. Примечание: для применения этого режима дрон должен лететь на высоте 40 см или выше над землей и необходим TOF. Режим зависания: оставайтесь и зависайте на высоте 40 см или выше над точкой взлета. Для реализации этого режима необходимы оптический датчик потока и TOF.
- Trim Roll Trim: обрезка вращения вокруг горизонтальной оси, проходящей через дрон сзади вперед. Это вращение буквально перекатывает дрон и перемещает его влево и вправо. Баллонный триммер используется для компенсации отклонения уровня установки датчиков. Pitch Trim: обрезка вращения вокруг горизонтальной оси, проходящей через дрон слева направо. Это вращение наклоняет дрон и перемещает его вперед или назад. Подстройка угла наклона используется для компенсации отклонения уровня установки датчиков.

Обратите внимание, что в вспомогательном режиме контроллер тяги работает как контроллер высоты.

#### Расширенное управление полетом

- Максимальный угол: установите максимальный шаг и вращение крена: крен/тангаж.
- Максимальная скорость рыскания: установите разрешенное рыскание: yaw .
- Макс. тяга: установите максимальную тягу.
- Минимальная тяга: установите минимальную тягу.
- Ограничение поворота: предотвращение внезапного падения тяги. Когда тяга падает ниже этого предела, скорости ниже скорости поворота не допускаются.
- Скорость поворота: это максимальная скорость, когда тяга ниже предела поворота.

#### Настроить устройство ввода

Следуя подсказкам, направьте контроллеры на каждый канал.

![cfclient input device configuration](_images/gamepad_set.png)

Конфигурация устройства ввода Cfclient

#### Данные о полете

На вкладке «Управление полетом» cfclient вы можете проверить статус дрона. Подробная информация отображается в правом нижнем углу, включая:

- Цель: целевой угол
- Фактический: измеренный угол
- Тяга: текущее значение тяги
- M1/M2/M3/M4: фактическая мощность двигателей

### Настройка онлайн-параметров

Настройте параметры ПИД онлайн

![PID parameters tunning](_images/cfclient_pid_tune.png)

Настройка параметров PID Cfclient

Примечание

- Измененные параметры вступают в силу в режиме реального времени, что позволяет избежать частой прошивки прошивки.
- В своем коде вы можете определить, какие параметры могут быть изменены ПК в режиме реального времени.
- Обратите внимание, что изменение параметров онлайн предназначено только для целей отладки. Измененные параметры не будут сохранены при выключении питания.

### Мониторинг полетных данных

Настройте параметры для мониторинга в разделе «Конфигурация журнала вкладок» и «Блоки журнала вкладок»:

![Log configuration](_images/log_set.png)

Конфигурация журнала

![Log Blocks](_images/log_set2.png)

Блоки журналов

Настройте рисование сигналов в реальном времени на Tab Plotter, чтобы отслеживать данные гироскопического акселерометра.

![accelerometer logging](_images/log_acc.png)

Регистрация акселерометра

## Направление пропеллера

- Установите гребные винты A и B согласно рисунку ниже.
- Во время самотестирования при включении питания проверьте, правильно ли вращаются пропеллеры.

![Propeller check](_images/espdrone_s2_v1_2_diretion2.png)

Проверка пропеллера

## Предполетная проверка

- Поместите дрон головой вперед, а хвостом (то есть частью антенны) сзади.
- Поместите дрон на ровную поверхность и включите его, когда дрон стоит на месте.
- Проверьте в cfclient, ровно ли стоит дрон.
- После установления связи проверьте, быстро ли мигает светодиод на хвосте дрона ЗЕЛЕНЫМ.
- Проверьте, мигает ли светодиод на головке дрона КРАСНЫМ, что указывает на низкий уровень заряда батареи.
- Слегка сдвиньте вперед контроллер Trust в левой части приложения (т. е. команды, управляемые левым пальцем), чтобы проверить, может ли дрон быстро отреагировать на команду.
- Проведите пальцем по правой области команд приложения (т. е. к командам, управляемым правым пальцем), чтобы проверить, хорошо ли работает управление направлением.
- Летайте и получайте удовольствие!
